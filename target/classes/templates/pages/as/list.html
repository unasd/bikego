<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout" layout:decorator="../layout/default">

<!-- page CSS -->
<th:block layout:fragment="css">
</th:block>

<!-- page 스크립트 -->
<th:block layout:fragment="script">
    <script type="text/javascript">
        function goPage(page){
            $('[name="listForm"]').children('[name="page"]').val(page);
            $('[name="listForm"]').submit();
        }

        function goSearch(){
            $('[name="listForm"]').children('[name="page"]').val(1);
            $('[name="listForm"]').submit();
        }

        function passwordChk(){
            alert('12321');
            $('#passwordForm').submit();
        }

        $(document).ready(function() {
            $('select').formSelect(); // select box 초기화
            $('#passwordModal').modal({
                dismissible: true, // Modal can be dismissed by clicking outside of the modal
                opacity: .5, // Opacity of modal background
                inDuration: 300, // Transition in duration
                outDuration: 200, // Transition out duration
                startingTop: '4%', // Starting top style attribute
                endingTop: '10%', // Ending top style attribute
                onCloseStart: function(e) {
                    console.info(e);
                    return false;
                }
            }); // modal 초기화

            $('.modal-trigger').on('click', function(e){
                $('#passwordAs').val('');
                $('#passwordModal').children('p').text($(this).children('span').text());
            });
        });
    </script>
</th:block>

<div layout:fragment="content" class="container">
    <div>
        <table class="highlight">
            <thead>
            <tr style="background-color: rgba(242, 242, 242, 0.5);">
                <th>제목</th>
                <th>작성자</th>
                <th>작성일</th>
            </tr>
            </thead>

            <tbody>
            <!-- CONTENTS !-->
            <tr th:each="as : ${asList}" class="row">
                <td class="modal-trigger" href="#passwordModal">
                    <a>
                        <span th:text="${as.titleAs}"></span>
                    </a>
                </td>
                <td>
                    <span th:text="${as.writerAs}"></span>
                </td>
                <td>
                    <span th:text="${#temporals.format(as.regdtAs, 'yyyy-MM-dd')}"></span>
                </td>
            </tr>
            </tbody>
        </table>
        <div class="row" style="background-color: rgba(242, 242, 242, 0.5);">
            <div class="col s9"></div>
            <div class="col s3">
                <a th:href="@{/as/post.do}" class="btn waves-effect waves-light">작성</a>
            </div>
        </div>
    </div>
    <div class="row">
        <form name="listForm" method="get" action="/as/list.do">
            <input type="hidden" name="page" th:value="${pagingResult.page}"/>
            <input type="hidden" name="listSize" th:value="${pagingResult.listSize}"/>
            <input type="hidden" name="pageSize" th:value="${pagingResult.pageSize}"/>
            <input type="hidden" name="direction" th:value="${pagingResult.direction}"/>
            <input type="hidden" name="sortProp" th:value="${pagingResult.sortProp}"/>
            <div class="input-field col s3">
                <select name="searchType">
                    <option value="titleAs" th:selected="(${searchDto.searchType} == 'titleAs')">제목</option>
                    <option value="contentsAs" th:selected="(${searchDto.searchType} == 'contentsAs')">내용</option>
                    <option value="locationAs" th:selected="(${searchDto.searchType} == 'locationAs')">위치</option>
                    <option value="writerAs" th:selected="(${searchDto.searchType} == 'writerAs')">작성자</option>
                </select>
            </div>
            <div class="input-field col s6">
                <input id="searchKeyword" name="searchKeyword" type="text" class="validate" th:value="${searchDto.searchKeyword}"
                       onkeypress="if( event.keyCode==13 ){goSearch();}">
                <label for="searchKeyword">검색어</label>
            </div>
            <div class="input-field col s3">
                <button class="btn waves-effect waves-light" type="button" id="searchBtn" onclick="javascript:goSearch();">검색</button>
            </div>
        </form>
    </div>
    <th:block th:if="${not #lists.isEmpty(asList)}">
        <ul class="pagination">
            <th:block th:if="${pagingResult.hasPrevious}">
                <li class="waves-effect"><a th:onclick="|javascript:goPage('${pagingResult.page-1}');|"><i class="material-icons">chevron_left</i></a></li>
            </th:block>
            <th:block th:unless="${pagingResult.hasPrevious}">
                <li class="disabled"><a><i class="material-icons">chevron_left</i></a></li>
            </th:block>

            <li th:each="pageCount : ${#numbers.sequence(pagingResult.startPage, pagingResult.endPage)}" th:class="${pagingResult.page == pageCount ? 'active' : 'waves-effect'}">
                <th:block th:if="${pagingResult.page == pageCount}"><a th:text="${pageCount}"></a></th:block>
                <th:block th:unless="${pagingResult.page == pageCount}"><a th:onclick="|javascript:goPage('${pageCount}');|" th:text="${pageCount}"></a></th:block>
            </li>

            <th:block th:if="${pagingResult.hasNext}">
                <li class="waves-effect"><a th:onclick="|javascript:goPage('${pagingResult.page+1}');|"><i class="material-icons">chevron_right</i></a></li>
            </th:block>
            <th:block th:unless="${pagingResult.hasNext}">
                <li class="disabled"><a><i class="material-icons">chevron_right</i></a></li>
            </th:block>
        </ul>
    </th:block>
    <!-- 패스워드 모달 -->
    <div id="passwordModal" class="modal">
        <div class="modal-content">
            <h5>비밀번호 입력</h5>
            <p>작성시 입력한 비밀번호</p>
            <form id="passwordForm">
                <div class="input-field">
                    <input id="passwordAs" name="passwordAs" type="password" class="validate" onkeypress="if( event.keyCode==13 ){passwordChk();}" required="">
                    <label for="passwordAs">Password</label>
                </div>
                <div class="modal-footer">
                    <button class="btn waves-effect waves-green btn-flat" type="submit" name="action">확인</button>
                </div>
            </form>
        </div>
    </div>
</div>
</html>
